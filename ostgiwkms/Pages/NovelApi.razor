@page "/Generate-Novel-Stream"
@inject ostgiwkms.Services.TextGenerationRequest GenerationRequest
@inject ostgiwkms.Services.AuthService AuthService

<head>
    <meta charset="utf-8" />
    <title>Novel Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/app.css" />
</head>
<body style="background-color:#2E006C; color:white; background-size:cover;">
    <div class="novelaiBody">
        <div class="hoverTrigger" style="position: relative; display: inline-block;">
            Settings
            <div class="hiddenSettings" style="display: none; position: absolute; background-color: #f0f0f0; padding: 10px; border: 1px solid #ccc; z-index: 1">
                <p>
                    <h3>Temperature</h3>

                    <SliderWithInput MinValue="0.0" MaxValue="2.0" Step="0.01" SelectedValue="@temperatureValue" />

                    <h3>Minimum Length</h3>
                    <SliderWithInput MinValue="0" MaxValue="500" Step="1" SelectedValue="@minLength" />

                    <h3>Maximum Length</h3>
                    <SliderWithInput MinValue=minLength MaxValue="1000" Step="1" SelectedValue="@maxLength" />
                </p>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var hoverTrigger = document.querySelector('.hoverTrigger');
                var hiddenContent = document.querySelector('.hiddenSettings');

                hoverTrigger.addEventListener('mouseover', function () {
                    hiddenContent.style.display = 'block';
                });

                hoverTrigger.addEventListener('mouseout', function () {
                    hiddenContent.style.display = 'none';
                });
            });
        </script>


        <div>
            <p>Your prompt: @inputText</p>
            <p>Response: "@generatedStream"</p>
        </div>

        <div style="margin: 100px"></div>

        <h3>Text Input</h3>
        <div class="textinput">
            <label for="textbox">Enter Prompt:</label>
            <input type="text" @bind="inputText" placeholder="Type something...">
            <button class="generateStream" @onclick="GenerateStream">Generate</button>
        </div>
    </div>
</body>

@code {
    private string generatedStream;
    private string inputText { get; set; }
    private double temperatureValue = 0.25;
    private int minLength = 10;
    private int maxLength = 1000;
    private string API_NOVELAI = "https://api.novelai.net/";
    private string API_KEY = "";
    private string placeholder = "oRGZjZE7QO7ltvuvg3iR6YvkKwkikzbLk2vdveunPtJU-qc92h_jZBKGG-bRfVto";

    private async Task AuthenticateAndLog()
    {
        try
        {
            // Replace "your_api_key" with your actual API key
            await AuthService.AuthenticateAsync(API_KEY);
            Console.WriteLine("Authentication successful");
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error during authentication: {ex.Message}");
        }
    }

    /*private async Task GenerateStream()
    {
        generatedStream = await GenerationRequest.GenerateNovelStream(inputText, temperatureValue, minLength, maxLength);
    }*/

    private async Task GenerateStream()
    {
        generatedStream = await GenerationRequest.GenerateNovel(inputText, temperatureValue, minLength, maxLength);
    }

}
